<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="author" content="李金磊" >

    <title>舞动的鹅卵石</title>

    

    <link rel="stylesheet" href="/stylesheets/styles.css">
    <link rel="stylesheet" href="/bower_components/normalize.css/normalize.css" >

    <script src="/javascripts/utils.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

  </head>
  <body>
    <div class="wrapper">

      <!-- 背景圆角 -->
      <div id="fixedRadiusCornerBg">
        <div id="fixedRadiusCornerBg_left" class="radiusCornerBg">
        </div>
        <div id="fixedRadiusCornerBg_right" class="radiusCornerBg">
        </div>
      </div>

      <header>
        <a href="/">
        <img id="round" style="" src="/images/avatar.png" />
        <p style="color:#252525;font-size:22px; font-style:bold;">李金磊的 Playground</p>
        <p style="color:#555555;text-align:left">「Less talk, more coding, professional made wheels.」</p>
      </a>
        <p class="view">


          <div id="tags">
            <h3>Tags：</h3>
            
    <a href="/tag/Canvas/index.html"> Canvas</a>

    <a href="/tag/Javascript/index.html"> Javascript</a>

    <a href="/tag/动效/index.html"> 动效</a>

    <a href="/tag/SVG/index.html"> SVG</a>

    <a href="/tag/Bezier/index.html"> Bezier</a>

    <a href="/tag/图形图像/index.html"> 图形图像</a>

    <a href="/tag/WebGL/index.html"> WebGL</a>

    <a href="/tag/流体模拟/index.html"> 流体模拟</a>

    <a href="/tag/运动学/index.html"> 运动学</a>

          </div>

      </header>

      <section id="content">
        <div>
  <h2>舞动的鹅卵石</h2>
  <p class="time">09 May 2015</p>


  <p><b>Demo:</b></p>
  <canvas id="canvas">
        当前的浏览器不支持canvas, canvas是HTML5里才有的标签，主要用于图形绘制操作
  </canvas>

  <p>实现代码</p>
  <p>1,利用贝塞尔曲线定义一个椭圆路径,通过 Math.random() 加入随机量，得到大小不一的椭圆路径</p>
  <pre id="pre" class="prettyprint">
function createAEgg(ctx, cx, cy) {
  return {
    origin: {x:cx, y:cy},//原点
    rotateAngle: 0,
    //定义抖动幅度在-3～3度之间
    increaseStep:0,
    path:null,
    init: function() {
      var random = Math.random();
      this.rotateAngle = Math.floor(random*360) / (Math.PI * 2);
      this.increaseStep = ((Math.floor(random*360) - 180) / 60) / (Math.PI * 2),
      this.path = createEllipsePath(17+Math.random()*13, 21+Math.random()*15)
    },
    updateDisplay: function() {
      ctx.save();
      ctx.translate(this.origin.x, this.origin.y);
      this.rotateAngle += this.increaseStep;
      ctx.rotate(this.rotateAngle)
      ctx.fill(this.path);
      ctx.restore();
    }
  }
}
  </pre>

  <p>2,创建随机分布在画布上的鹅卵石数组，lastEgg 保存了上一次生成的鹅卵石，通过与当前鹅卵石中心点坐标的对比，保证两个连续生成的鹅卵石不完全重叠</p>
  <pre class="prettyprint">
//创建随机分布在画布上的鹅卵石数组
function createEggList() {
  var lastEgg;
  for (var i=0; i< 100; i++) {
    var egg = createAEgg(ctx, Math.random()*canvasWidth, Math.random()*canvasHeight);
    egg.init();
    if (lastEgg && (Math.abs(egg.origin.x - lastEgg.origin.x) < 20 || Math.abs(egg.origin.y - lastEgg.origin.y) < 24)) {
      i -= 1;
    }
    else {
      eggArr[i] = egg;
      lastEgg = egg;
    }
  }
}
  </pre>

  <p>3,在每一帧遍历 eggArr, 调用每个鹅卵石的 updateDisplay() 函数。</p>
  <pre class="prettyprint">
function enterFrame() {
  ctx.clearRect(0,0, canvasWidth, canvasHeight);
  drawCanvasBackground();
  ctx.strokeStyle = "#cccccc";
  ctx.fillStyle = "#cccccc";

  for (var i=0; i< eggArr.length; i++) {
    eggArr[i].updateDisplay();
  }
}
  </pre>

  <script src="/javascripts/draw.js"></script>

  <script type="text/javascript">
  ctx.canvas.height  = 280;
  canvasHeight = canvas.offsetHeight;
  centerY = canvasHeight/2.0;

  function createAEgg(ctx, cx, cy) {
    return {
      origin: {x:cx, y:cy},//原点
      rotateAngle: 0,
      //定义抖动幅度在-3～3度之间
      increaseStep:0,
      path:null,
      init: function() {
        var random = Math.random();
        this.rotateAngle = Math.floor(random*360) / (Math.PI * 2);
        this.increaseStep = ((Math.floor(random*360) - 180) / 60) / (Math.PI * 2),
        this.path = createEllipsePath(17+Math.random()*13, 21+Math.random()*15)
      },
      updateDisplay: function() {
        ctx.save();
        ctx.translate(this.origin.x, this.origin.y);
        this.rotateAngle += this.increaseStep;
        ctx.rotate(this.rotateAngle)
        ctx.fill(this.path);
        ctx.restore();
      }
    }
  }

  var eggArr = new Array();

  //创建随机分布在画布上的鹅卵石数组
  function createEggList() {
    var lastEgg;
    for (var i=0; i<100; i++) {
      var egg = createAEgg(ctx, Math.random()*canvasWidth, Math.random()*canvasHeight);
      egg.init();
      if (lastEgg && (Math.abs(egg.origin.x - lastEgg.origin.x) < 20 || Math.abs(egg.origin.y - lastEgg.origin.y) < 24)) {
        i -= 1;
      }
      else {
        eggArr[i] = egg;
        lastEgg = egg;
      }
    }
  }

  function enterFrame() {
    ctx.clearRect(0,0, canvasWidth, canvasHeight);
    drawCanvasBackground();
    ctx.strokeStyle = "#cccccc";
    ctx.fillStyle = "#cccccc";

    for (var i=0; i<eggArr.length; i++) {
      eggArr[i].updateDisplay();
    }
  }

  setCanvasScaleIfNeeds();
  createEggList()
  setInterval("enterFrame()", 40);

  </script>

</div>

      </section>

      <!-- 文字淡出 -->
      <!-- <div id="fadeoutContainer">
        <div id="topFadeoutCorner">
        </div>

      </div> -->
      <svg width="0" height="0">
        <defs>
          <clipPath id="clip3">
             <rect width="568" height="426" rx="85.2" ry="85.2"></rect>
          </clipPath>
          <clipPath id="clip4">
              <ellipse cx="284" cy="213" rx="284" ry="213"></ellipse>
          </clipPath>
          <filter id="filter2">
            <feGaussianBlur stdDeviation="10"></feGaussianBlur>
          </filter>
          <filter id="filter">
            <feGaussianBlur stdDeviation="0.03"></feGaussianBlur>
          </filter>
          <filter id="filter2">
            <feGaussianBlur stdDeviation="5"></feGaussianBlur>
          </filter>
          <linearGradient id="gradient" x1="0" y1="00%" x2="0" y2="100%">
            <stop stop-color="black" offset="0"></stop>
            <stop stop-color="white" offset="1"></stop>
          </linearGradient>
          <clipPath id="clipping4">
            <rect width="5680" height="2" rx="85.2" ry="85.2"></rect>
          </clipPath>
        </defs>
      </svg>
      <footer>
        <p><small>contact me：grenlight@icloud.com</small></p>
      </footer>
    </div>
    <script src="/javascripts/scale.fix.js"></script>
<script src="/javascripts/prettify/run_prettify.js"></script>
<link rel="stylesheet" href="/stylesheets/code-prettify-sunburst.css">

</script>
  </body>
</html>
