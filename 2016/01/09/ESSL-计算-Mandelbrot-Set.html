<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="viewport"
        content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,shrink-to-fit=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="author" content="李金磊" >

  <title>Essl 计算 Mandelbrot Set</title>

  <link rel="stylesheet" href="/stylesheets/styles.css">
  <link rel="stylesheet" href="/stylesheets/syntax.css">

</head>
<body>
<div class="wrapper" id="wrapper">
  <script type="text/javascript" src="/bin/gren.js"></script>
  <h3>曼德博分形</h3>
<div id="Container" style="width:100%" >

</div>

<div>

    <figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"> <span class="nx">precision</span> <span class="nx">highp</span> <span class="kr">float</span><span class="p">;</span>

 <span class="nx">varying</span> <span class="nx">vec2</span> <span class="nx">pixel</span><span class="p">;</span>

 <span class="kr">const</span> <span class="kr">int</span> <span class="nx">maxRepeats</span> <span class="o">=</span> <span class="mi">30</span><span class="p">;</span>
 <span class="kr">const</span> <span class="nx">vec2</span> <span class="nx">topRight</span> <span class="o">=</span> <span class="nx">vec2</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
 <span class="kr">const</span> <span class="nx">vec2</span> <span class="nx">bottomLeft</span> <span class="o">=</span> <span class="nx">vec2</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
 <span class="kr">float</span> <span class="nx">drow</span> <span class="o">=</span> <span class="nx">topRight</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">bottomLeft</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
 <span class="kr">float</span> <span class="nx">dcol</span> <span class="o">=</span> <span class="nx">topRight</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">bottomLeft</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>

 <span class="nx">vec2</span> <span class="nx">multiply</span><span class="p">(</span><span class="nx">vec2</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">vec2</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">return</span> <span class="nx">vec2</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">x</span><span class="o">*</span><span class="nx">b</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">a</span><span class="p">.</span><span class="nx">y</span><span class="o">*</span><span class="nx">b</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span>  <span class="nx">a</span><span class="p">.</span><span class="nx">y</span><span class="o">*</span><span class="nx">b</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">a</span><span class="p">.</span><span class="nx">x</span><span class="o">*</span><span class="nx">b</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
 <span class="p">}</span>
 <span class="k">void</span> <span class="nx">main</span><span class="p">(</span><span class="k">void</span><span class="p">)</span> <span class="p">{</span>
     <span class="nx">vec2</span> <span class="nx">Z</span> <span class="o">=</span> <span class="nx">vec2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
     <span class="nx">vec2</span> <span class="nx">p</span> <span class="o">=</span> <span class="nx">vec2</span><span class="p">(</span><span class="nx">bottomLeft</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="p">(</span><span class="nx">pixel</span><span class="p">.</span><span class="nx">x</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="nx">dcol</span><span class="p">,</span> <span class="nx">bottomLeft</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="p">(</span><span class="nx">pixel</span><span class="p">.</span><span class="nx">y</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="nx">drow</span><span class="p">);</span>
     <span class="kr">int</span> <span class="nx">stepper</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

     <span class="k">for</span> <span class="p">(</span><span class="kr">int</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">maxRepeats</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
         <span class="k">if</span> <span class="p">(</span><span class="nx">abs</span><span class="p">(</span><span class="nx">dot</span><span class="p">(</span><span class="nx">Z</span><span class="p">,</span> <span class="nx">Z</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">4.0</span><span class="p">)</span> <span class="p">{</span>
             <span class="k">break</span><span class="p">;</span>
         <span class="p">}</span>
         <span class="nx">Z</span> <span class="o">=</span> <span class="nx">multiply</span><span class="p">(</span><span class="nx">Z</span><span class="p">,</span> <span class="nx">Z</span><span class="p">)</span> <span class="o">+</span> <span class="nx">p</span><span class="p">;</span>
         <span class="nx">stepper</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
     <span class="p">}</span>

     <span class="k">if</span> <span class="p">(</span><span class="nx">stepper</span> <span class="o">==</span> <span class="nx">maxRepeats</span><span class="p">)</span> <span class="p">{</span>
         <span class="nx">gl_FragColor</span> <span class="o">=</span> <span class="nx">vec4</span><span class="p">(</span><span class="nx">Z</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">Z</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span>  <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">.);</span>
     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
         <span class="nx">gl_FragColor</span> <span class="o">=</span> <span class="nx">vec4</span><span class="p">(</span><span class="mi">0</span><span class="p">.,</span> <span class="mi">0</span><span class="p">.,</span> <span class="mi">0</span><span class="p">.,</span> <span class="mi">1</span><span class="p">.);</span>
     <span class="p">}</span>
 <span class="p">}</span>
    </code></pre></figure>
</div>
<script type="text/javascript" src="/bin/effects.js"></script>
<script type="text/javascript">
 var container = document.getElementById('Container');
 var fractal = new EFFECT.MandelbrotSet(container.offsetWidth, container.offsetWidth/2);
 container.appendChild(fractal.domElement);
</script>
</div>

</body>
</html>
