!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("GREN")):"function"==typeof define&&define.amd?define("EFFECT",["GREN"],t):"object"==typeof exports?exports.EFFECT=t(require("GREN")):e.EFFECT=t(e.GREN)}(this,function(e){return function(e){function t(i){if(r[i])return r[i].exports;var n=r[i]={exports:{},id:i,loaded:!1};return e[i].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1);Object.keys(i).forEach(function(e){"default"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})})},function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.PSSoundWave=void 0;var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),s=function u(e,t,r){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,t);if(void 0===i){var n=Object.getPrototypeOf(e);return null===n?void 0:u(n,t,r)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(r)},l=r(2),c=r(3);t.PSSoundWave=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?300:arguments[0],r=arguments.length<=1||void 0===arguments[1]?100:arguments[1];i(this,t);var a=n(this,Object.getPrototypeOf(t).call(this));if(a.renderer=new c.WebGLRenderer,a.renderer.setStyle(e,r,"margin:0px; position:absolute; z-index:1;"),a.gl=a.renderer.gl,a.domElement=a.renderer.canvas,a.renderer.isWebGLSuported===!1)return n(a);a.colors=[[1,1,1,1],[1,1,1,.4],[1,1,1,.3],[1,1,1,.2],[1,1,1,.1]],a.mvMatrixList=[];var o=a.renderer.canvasHeight/4,s=c.Matrix4.identity();c.Matrix4.translate(s,[0,o,0]),a.mvMatrixList.push(s);var u=c.Matrix4.identity();c.Matrix4.translate(u,[0,o,0]),c.Matrix4.scale(u,[1,.9,1]),a.mvMatrixList.push(u);var h=c.Matrix4.identity();c.Matrix4.translate(h,[0,o,0]),c.Matrix4.scale(h,[1,.7,1]),a.mvMatrixList.push(h);var f=c.Matrix4.identity();c.Matrix4.translate(f,[0,o,0]),c.Matrix4.scale(f,[1,.3,1]),a.mvMatrixList.push(f);var v=c.Matrix4.identity();return c.Matrix4.translate(v,[0,o,0]),c.Matrix4.scale(v,[1,.5,1]),c.Matrix4.rotate(v,v,Math.PI,[0,0,1]),a.mvMatrixList.push(v),a.pMatrix=c.Matrix4.orthogonal(0,a.renderer.canvasWidth,0,a.renderer.canvasHeight,-5e3,5e3),a._initProgram(),a.wave=new l.Wave(a.gl,a.prg,a.renderer.canvasWidth,0,function(){a.startAnimating()}),a}return a(t,e),o(t,[{key:"_interactVertice",value:function(){this.vertices=[];for(var e=void 0,t=void 0,r=void 0,i=void 0,n=0;n<this.amplitudes.length;n++){var a=this.amplitudes[n],o=4*n;e=this.vertexVectors[o],t=this.vertexVectors[o+1],r=this.vertexVectors[o+2],i=this.vertexVectors[o+3],this.vertices=this.vertices.concat([e.x,e.y+a,t.x,t.y+a,i.x,i.y+a,r.x,i.y+a])}}},{key:"_initProgram",value:function(){this.prg=this.gl.makeProgram(c.commonVS,c.commonFS),this.prg&&(this.prg.setAttribLocations(["vertexPosition"]),this.prg.setUniformLocations(["pMatrix","mvMatrix","color"]),this.gl.uniformMatrix4fv(this.prg.pMatrix,!1,this.pMatrix))}},{key:"enterFrame",value:function(){s(Object.getPrototypeOf(t.prototype),"enterFrame",this).call(this),this.gl.clearColor(0,0,0,0),this.gl.viewport(0,0,this.renderer.canvasWidth,this.renderer.canvasHeight),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.wave.generateAWave(),this.gl.enable(this.gl.BLEND),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA);for(var e=this.mvMatrixList.length-1;e>=0;e--)this.gl.uniform4fv(this.prg.color,this.colors[e]),this.gl.uniformMatrix4fv(this.prg.mvMatrix,!1,this.mvMatrixList[e]),this.wave.draw()}}]),t}(c.IAnimation)},function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}();r(3),t.Wave=function(){function e(t,r,n,a,o){i(this,e),this.gl=t,this.prg=r,this.callBack=o,this.indices=[],this.indicesLength=0,this.worker=new Worker("../bin/effects_webworker.js"),this.worker.onmessage=this.handleMessage.bind(this),this.worker.postMessage({effectType:"soundwave",params:{drawWidth:n,positionY:a,devicePixelRatio:window.devicePixelRatio}})}return n(e,[{key:"handleMessage",value:function(e){if(0===this.indicesLength){this.indicesLength=e.data.length;var t=this.gl.createElementBufferWithData(e.data);this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,t),this.generateAWave()}else{var r=this.gl.createArrayBufferWithTypedArray(e.data);this.gl.enableVertexAttribArray(this.prg.vertexPosition),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,r),this.gl.vertexAttribPointer(this.prg.vertexPosition,2,this.gl.FLOAT,!1,0,0),this.callBack&&(this.callBack(),this.callBack=null)}}},{key:"generateAWave",value:function(){this.worker.postMessage(null)}},{key:"draw",value:function(){this.gl.drawElements(this.gl.TRIANGLES,this.indicesLength,this.gl.UNSIGNED_SHORT,0)}}]),e}()},function(t,r){t.exports=e}])});