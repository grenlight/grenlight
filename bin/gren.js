!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("GREN",[],t):"object"==typeof exports?exports.GREN=t():e.GREN=t()}(this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var i=r[n]={exports:{},id:n,loaded:!1};return e[n].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(1);Object.defineProperty(t,"WebGLRenderer",{enumerable:!0,get:function(){return n.WebGLRenderer}});var i=r(4);Object.defineProperty(t,"commonVS",{enumerable:!0,get:function(){return i.commonVS}}),Object.defineProperty(t,"commonFS",{enumerable:!0,get:function(){return i.commonFS}});var o=r(5);Object.defineProperty(t,"basicFilterVS",{enumerable:!0,get:function(){return o.basicFilterVS}});var a=r(6);Object.defineProperty(t,"basicTextureVS",{enumerable:!0,get:function(){return a.basicTextureVS}}),Object.defineProperty(t,"basicTextureFS",{enumerable:!0,get:function(){return a.basicTextureFS}});var u=r(7);Object.defineProperty(t,"BoxBlurFilter",{enumerable:!0,get:function(){return u.BoxBlurFilter}});var s=r(11);Object.defineProperty(t,"LuminanceFilter",{enumerable:!0,get:function(){return s.LuminanceFilter}});var l=r(12);Object.defineProperty(t,"GaussianBlurFilter",{enumerable:!0,get:function(){return l.GaussianBlurFilter}});var c=r(13);Object.defineProperty(t,"GoraudDefine",{enumerable:!0,get:function(){return c.GoraudDefine}}),Object.defineProperty(t,"GoraudCalculator",{enumerable:!0,get:function(){return c.GoraudCalculator}});var f=r(14);Object.defineProperty(t,"GLBezier",{enumerable:!0,get:function(){return f.GLBezier}});var h=r(9);Object.defineProperty(t,"Matrix4",{enumerable:!0,get:function(){return h.Matrix4}});var v=r(15);Object.defineProperty(t,"Matrix2d",{enumerable:!0,get:function(){return v.Matrix2d}});var d=r(16);Object.defineProperty(t,"Vector2",{enumerable:!0,get:function(){return d.Vector2}});var g=r(17);Object.defineProperty(t,"Vector3",{enumerable:!0,get:function(){return g.Vector3}});var y=r(18);Object.defineProperty(t,"Vector4",{enumerable:!0,get:function(){return y.Vector4}});var p=r(19);Object.defineProperty(t,"random",{enumerable:!0,get:function(){return p.random}});var m=r(20);Object.defineProperty(t,"IAnimation",{enumerable:!0,get:function(){return m.IAnimation}});var b=r(21);Object.defineProperty(t,"TouchManager",{enumerable:!0,get:function(){return b.TouchManager}});var x=r(22);Object.defineProperty(t,"PlaneGeometry",{enumerable:!0,get:function(){return x.PlaneGeometry}});var E=r(25);Object.defineProperty(t,"GLTexture1D",{enumerable:!0,get:function(){return E.GLTexture1D}});var T=r(10);Object.defineProperty(t,"GLTexture2D",{enumerable:!0,get:function(){return T.GLTexture2D}});var _=r(2);Object.keys(_).forEach(function(e){"default"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return _[e]}})});try{window.devicePixelRatio=window.devicePixelRatio||1}catch(P){}},function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t["default"]=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.WebGLRenderer=void 0;var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(2),u=n(a),s=r(3),l=["webgl","experimental-webgl","webkit-3d","moz-webgl"];t.WebGLRenderer=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?0:arguments[0],r=arguments.length<=1||void 0===arguments[1]?0:arguments[1],n=arguments.length<=2||void 0===arguments[2]?null:arguments[2];i(this,e),this.canvasWidth=0,this.canvasHeight=0,this.canvas=null,null!==n?this.canvas=document.getElementById(n):this.canvas=document.createElement("canvas"),this.gl=this.getGLContext(),null===this.gl?this.isWebGLSuported=!1:(this.isWebGLSuported=!0,this.gl.createArrayBufferWithData=u.createArrayBufferWithData,this.gl.createArrayBufferWithDataAndType=u.createArrayBufferWithDataAndType,this.gl.createArrayBufferWithTypedArray=u.createArrayBufferWithTypedArray,this.gl.createElementBufferWithData=u.createElementBufferWithData,this.gl.createElementBufferWithTypedArray=u.createElementBufferWithTypedArray,this.gl.createTextureWithData=u.createTextureWithData,this.gl.createTexture1D=u.createTexture1D,this.gl.makeProgram=u.makeProgram),this.setStyle(t,r)}return o(e,[{key:"setStyle",value:function(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0],t=arguments.length<=1||void 0===arguments[1]?0:arguments[1],r=arguments.length<=2||void 0===arguments[2]?null:arguments[2];null!=this.canvas&&0!==e&&0!==t&&(this.canvasWidth=e*window.devicePixelRatio,this.canvasHeight=t*window.devicePixelRatio,this.canvas.width=this.canvasWidth,this.canvas.height=this.canvasHeight,null===r?(this.canvas.style.width=e+"px",this.canvas.style.height=t+"px"):this.canvas.setAttribute("style","width:"+e+"px; height: "+t+"px; "+r+";"),this.canvas.style.webkitTapHighlightColor="rgba(0, 0, 0, 0)",this.centerX=this.canvasWidth/2,this.centerY=this.canvasHeight/2)}},{key:"getGLContext",value:function(){var e=null;if(s.Security.validDomain()===!1)return e;for(var t=0;t<l.length&&!(e=this.canvas.getContext(l[t],{}));++t);return null===e&&this._createNotSupportMessageView(),e}},{key:"_createNotSupportMessageView",value:function(){this.canvas=document.createElement("div"),this.canvas.setAttribute("style","color: #454545; padding: 25px; font-size: 18px;"),this.canvas.innerHTML="<p>您当前使用的浏览器不支持 WebGL.</p>\n<p>支持 WebGL 的手机系统版本及浏览器版本有: </p>\n<ul>\n<li>iOS 8.0, Android 5.0 及以上版本</li>\n<li>IE 11 及微软 Edge 浏览所有版本</li>\n<li>FireFox for PC/Mac 40 及以上版本</li>\n<li>Chrome for PC/Mac 43 及以上版本</li>\n<li>Safari for Mac 8.0 及以上版本</li>\n</ul>"}}]),e}()},function(e,t){"use strict";function r(e,t){function r(e,t){var r=i.createShader(e);if(i.shaderSource(r,t),i.compileShader(r),!i.getShaderParameter(r,i.COMPILE_STATUS))throw new Error("compile error: "+i.getShaderInfoLog(r));return r}var n=this,i=this,o=this.createProgram();if(this.attachShader(o,r(this.VERTEX_SHADER,e)),this.attachShader(o,r(this.FRAGMENT_SHADER,t)),this.linkProgram(o),!this.getProgramParameter(o,this.LINK_STATUS))throw new Error("link error: "+this.getProgramInfoLog(o));return this.useProgram(o),o.setAttribLocations=function(e){for(var t=0,r=e.length;r>t;t+=1)o[e[t]]=n.getAttribLocation(o,e[t])},o.setUniformLocations=function(e){for(var t=0,r=e.length;r>t;t+=1)o[e[t]]=n.getUniformLocation(o,e[t])},o}function n(e){return this.createArrayBufferWithDataAndType(e,this.STREAM_DRAW)}function i(e,t){var r=this.createBuffer();return this.bindBuffer(this.ARRAY_BUFFER,r),this.bufferData(this.ARRAY_BUFFER,new Float32Array(e),t),this.bindBuffer(this.ARRAY_BUFFER,null),r}function o(e){var t=arguments.length<=1||void 0===arguments[1]?this.STATIC_DRAW:arguments[1],r=this.createBuffer();return this.bindBuffer(this.ARRAY_BUFFER,r),this.bufferData(this.ARRAY_BUFFER,e,t),this.bindBuffer(this.ARRAY_BUFFER,null),r}function a(e){var t=new Uint16Array(e);return this.createElementBufferWithTypedArray(t)}function u(e){var t=this.createBuffer();return this.bindBuffer(this.ELEMENT_ARRAY_BUFFER,t),this.bufferData(this.ELEMENT_ARRAY_BUFFER,e,this.STATIC_DRAW),this.bindBuffer(this.ELEMENT_ARRAY_BUFFER,null),t}function s(e,t){var r=new Image;r.onload=function(){t&&t(r)},r.src=e}Object.defineProperty(t,"__esModule",{value:!0}),t.makeProgram=r,t.createArrayBufferWithData=n,t.createArrayBufferWithDataAndType=i,t.createArrayBufferWithTypedArray=o,t.createElementBufferWithData=a,t.createElementBufferWithTypedArray=u,t.createImageByURL=s},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=["l","i","j","i","n","l","e","i"],o=["l","o","c","a","l","h","o","s","t"];t.Security=function(){function e(){r(this,e)}return n(e,null,[{key:"validDomain",value:function(){var e=i.join(""),t=o.join(""),r=window.location.hostname.split("."),n=r[0];return 3===r.length&&(n=r[1]),n===decodeURI(e)||n===decodeURI(t)}}]),e}()},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.commonVS="\nattribute vec3 vertexPosition;\n\nuniform mat4 mvMatrix;\nuniform mat4 pMatrix;\n\nvoid main(void) {\n  gl_Position = pMatrix * mvMatrix * vec4(vertexPosition, 1.0);\n}\n",t.commonFS="\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform vec4 color;\n\nvoid main(void) {\n  gl_FragColor = color;\n}\n"},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.basicFilterVS="\nattribute vec3 vertexPosition;\nattribute vec2 vTextureCoord;\n\nuniform mat4 mvMatrix;\nuniform mat4 pMatrix;\n\nvarying vec2 texCoord;\n\nvoid main(void) {\n    texCoord = vTextureCoord;\n    gl_Position = pMatrix * mvMatrix * vec4(vertexPosition, 1.0);\n}\n"},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.basicTextureVS="\nattribute vec3 vertexPosition;\nattribute vec2 vTextureCoord;\n\nuniform mat4 mvMatrix;\nuniform mat4 pMatrix;\nuniform bool useTexture;\n\nvarying vec2 texCoord;\n\nvoid main(void) {\n    if (useTexture) {\n        texCoord = vTextureCoord;\n    }\n    gl_Position = pMatrix * mvMatrix * vec4(vertexPosition, 1.0);\n}\n",t.basicTextureFS="\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D texture;\nuniform vec4 color;\nuniform bool useTexture;\n\nvarying vec2 texCoord;\n\nvoid main(void) {\n    if (useTexture) {\n         gl_FragColor = texture2D(texture, texCoord);\n    } else {\n         gl_FragColor = color;\n    }\n}\n"},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.BoxBlurFilter=void 0;var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=function f(e,t,r){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,t);if(void 0===n){var i=Object.getPrototypeOf(e);return null===i?void 0:f(i,t,r)}if("value"in n)return n.value;var o=n.get;if(void 0!==o)return o.call(r)},s=r(8),l=(r(10),r(5)),c=(r(9),"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D texture;\nuniform float textureWidth;\nuniform float textureHeight;\n\nvarying vec2 texCoord;\n\n#define stepX  1.5/textureWidth\n#define stepY  1.5/textureHeight\n const float blurX = 2.0;\n const float blurY = 2.0;\n\nvoid main(void) {\n    vec4 sum = vec4(0.0, 0.0, 0.0, 0.0);\n    const float rowCount = blurY * 2.0 + 1.0;\n    const float colCount = blurX * 2.0 + 1.0;\n    for (float row=0.0;row<rowCount; row++) {\n        float newY = texCoord.y + (stepY * ((blurY + 1.0)-row));\n        for (float col=0.0; col<colCount; col++) {\n            float newX = texCoord.x + (stepX * (col-(blurX + 1.0)));\n            sum = sum + texture2D(texture,vec2(newX, newY));\n        }     \n    }\n    gl_FragColor = sum /25.0;\n}\n");t.BoxBlurFilter=function(e){function t(){return n(this,t),i(this,Object.getPrototypeOf(t).apply(this,arguments))}return o(t,e),a(t,[{key:"getProgramParams",value:function(){return[l.basicFilterVS,c,["vertexPosition","vTextureCoord"],["pMatrix","mvMatrix","texture","textureWidth","textureHeight"]]}},{key:"setAttribAndUniforms",value:function(){u(Object.getPrototypeOf(t.prototype),"setAttribAndUniforms",this).call(this),this.gl.uniform1f(this.prg.textureWidth,this.texture.texWidth),this.gl.uniform1f(this.prg.textureHeight,this.texture.texHeight)}}]),t}(s.IFilter)},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.IFilter=void 0;var i=function(){function e(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,u=e[Symbol.iterator]();!(n=(a=u.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(s){i=!0,o=s}finally{try{!n&&u["return"]&&u["return"]()}finally{if(i)throw o}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(9);t.IFilter=function(){function e(){n(this,e)}return o(e,[{key:"excute",value:function(e){return this.texture=e,this.gl=e.gl,this.makeProgram(),this._generateBuffer(),this.gl.viewport(0,0,e.texWidth,e.texHeight),this.pMatrix=a.Matrix4.orthogonal(0,e.texWidth,0,e.texHeight,-1e3,1e3),this.configBuffer(e),this.setAttribAndUniforms(),this.draw(),this.outputTexture}},{key:"_generateBuffer",value:function(){if(!this.textureVertexBuffer){var e=[0,0,0,1,1,0,1,1];this.textureVertexBuffer=this.gl.createArrayBufferWithData(e);var t=[0,1,2,1,2,3],r=this.gl.createElementBufferWithData(t);this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,r)}}},{key:"makeProgram",value:function(){if(!this.prg){var e=this.getProgramParams(),t=i(e,4),r=t[0],n=t[1],o=t[2],a=t[3];this.prg=this.gl.makeProgram(r,n),this.prg.setAttribLocations(o),this.prg.setUniformLocations(a)}}},{key:"getProgramParams",value:function(){return[]}},{key:"setAttribAndUniforms",value:function(){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuffer),this.gl.vertexAttribPointer(this.prg.vertexPosition,3,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.prg.vertexPosition),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.textureVertexBuffer),this.gl.vertexAttribPointer(this.prg.vTextureCoord,2,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.prg.vTextureCoord),this.gl.uniformMatrix4fv(this.prg.pMatrix,!1,this.pMatrix),this.gl.uniformMatrix4fv(this.prg.mvMatrix,!1,new a.Matrix4),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture.texture),this.gl.uniform1i(this.prg.texture,0)}},{key:"configBuffer",value:function(e){var t=[0,e.texHeight,0,0,0,0,e.texWidth,e.texHeight,0,e.texWidth,0,0];this.vertexBuffer=this.gl.createArrayBufferWithData(t),this.outputTexture=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,this.outputTexture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,e.texWidth,e.texHeight,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST);var r=this.gl.createRenderbuffer();this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,r),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_COMPONENT16,e.texWidth,e.texHeight);var n=this.gl.createFramebuffer();this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,n),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this.outputTexture,0),this.gl.framebufferRenderbuffer(this.gl.FRAMEBUFFER,this.gl.DEPTH_ATTACHMENT,this.gl.RENDERBUFFER,r)}},{key:"draw",value:function(){this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.gl.enable(this.gl.BLEND),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.drawElements(this.gl.TRIANGLES,6,this.gl.UNSIGNED_SHORT,0),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null)}}]),e}()},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();t.Matrix4=function(){function e(){return r(this,e),e.identity()}return n(e,null,[{key:"identity",value:function(){return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}},{key:"copy",value:function(t){var r=e.identity();return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r}},{key:"perspective",value:function(t,r,n,i){var o=1/Math.tan(t/2),a=1/(n-i),u=e.identity();return u[0]=o/r,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=o,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=(i+n)*a,u[11]=-1,u[12]=0,u[13]=0,u[14]=2*i*n*a,u[15]=0,u}},{key:"orthogonal",value:function(t,r,n,i,o,a){var u=1/(t-r),s=1/(n-i),l=1/(o-a),c=e.identity();return c[0]=-2*u,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*s,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*l,c[11]=0,c[12]=(t+r)*u,c[13]=(i+n)*s,c[14]=(a+o)*l,c[15]=1,c}},{key:"scale",value:function(e,t){var r=t[0],n=t[1],i=t[2];e[0]*=r,e[1]*=r,e[2]*=r,e[3]*=r,e[4]*=n,e[5]*=n,e[6]*=n,e[7]*=n,e[8]*=i,e[9]*=i,e[10]*=i,e[11]*=i}},{key:"translate",value:function(e,t){var r=t[0],n=t[1],i=t[2];return e[12]+=e[0]*r+e[4]*n+e[8]*i,e[13]+=e[1]*r+e[5]*n+e[9]*i,e[14]+=e[2]*r+e[6]*n+e[10]*i,e[15]+=e[3]*r+e[7]*n+e[11]*i,e}},{key:"inverse",value:function(t){var r=t[0],n=t[1],i=t[2],o=t[3],a=t[4],u=t[5],s=t[6],l=t[7],c=t[8],f=t[9],h=t[10],v=t[11],d=t[12],g=t[13],y=t[14],p=t[15],m=r*u-n*a,b=r*s-i*a,x=r*l-o*a,E=n*s-i*u,T=n*l-o*u,_=i*l-o*s,P=c*g-f*d,R=c*y-h*d,A=c*p-v*d,w=f*y-h*g,O=f*p-v*g,M=h*p-v*y,F=m*M-b*O+x*w+E*A-T*R+_*P;if(!F)return null;F=1/F;var B=e.identity();return B[0]=(u*M-s*O+l*w)*F,B[1]=(i*O-n*M-o*w)*F,B[2]=(g*_-y*T+p*E)*F,B[3]=(h*T-f*_-v*E)*F,B[4]=(s*A-a*M-l*R)*F,B[5]=(r*M-i*A+o*R)*F,B[6]=(y*x-d*_-p*b)*F,B[7]=(c*_-h*x+v*b)*F,B[8]=(a*O-u*A+l*P)*F,B[9]=(n*A-r*O-o*P)*F,B[10]=(d*T-g*x+p*m)*F,B[11]=(f*x-c*T-v*m)*F,B[12]=(u*R-a*w-s*P)*F,B[13]=(r*w-n*R+i*P)*F,B[14]=(g*b-d*E-y*m)*F,B[15]=(c*E-f*b+h*m)*F,B}},{key:"rotate",value:function(e,t,r,n){var i,o,a,u,s,l,c,f,h,v,d,g,y,p,m,b,x,E,T,_,P,R,A,w,O=n[0],M=n[1],F=n[2],B=Math.sqrt(O*O+M*M+F*F);return B=1/B,O*=B,M*=B,F*=B,i=Math.sin(r),o=Math.cos(r),a=1-o,u=t[0],s=t[1],l=t[2],c=t[3],f=t[4],h=t[5],v=t[6],d=t[7],g=t[8],y=t[9],p=t[10],m=t[11],b=O*O*a+o,x=M*O*a+F*i,E=F*O*a-M*i,T=O*M*a-F*i,_=M*M*a+o,P=F*M*a+O*i,R=O*F*a+M*i,A=M*F*a-O*i,w=F*F*a+o,e[0]=u*b+f*x+g*E,e[1]=s*b+h*x+y*E,e[2]=l*b+v*x+p*E,e[3]=c*b+d*x+m*E,e[4]=u*T+f*_+g*P,e[5]=s*T+h*_+y*P,e[6]=l*T+v*_+p*P,e[7]=c*T+d*_+m*P,e[8]=u*R+f*A+g*w,e[9]=s*R+h*A+y*w,e[10]=l*R+v*A+p*w,e[11]=c*R+d*A+m*w,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e}},{key:"multiplyMatrices",value:function(t,r){var n=e.identity(),i=t[0],o=t[4],a=t[8],u=t[12],s=t[1],l=t[5],c=t[9],f=t[13],h=t[2],v=t[6],d=t[10],g=t[14],y=t[3],p=t[7],m=t[11],b=t[15],x=r[0],E=r[4],T=r[8],_=r[12],P=r[1],R=r[5],A=r[9],w=r[13],O=r[2],M=r[6],F=r[10],B=r[14],D=r[3],j=r[7],k=r[11],C=r[15];return n[0]=i*x+o*P+a*O+u*D,n[4]=i*E+o*R+a*M+u*j,n[8]=i*T+o*A+a*F+u*k,n[12]=i*_+o*w+a*B+u*C,n[1]=s*x+l*P+c*O+f*D,n[5]=s*E+l*R+c*M+f*j,n[9]=s*T+l*A+c*F+f*k,n[13]=s*_+l*w+c*B+f*C,n[2]=h*x+v*P+d*O+g*D,n[6]=h*E+v*R+d*M+g*j,n[10]=h*T+v*A+d*F+g*k,n[14]=h*_+v*w+d*B+g*C,n[3]=y*x+p*P+m*O+b*D,n[7]=y*E+p*R+m*M+b*j,n[11]=y*T+p*A+m*F+b*k,n[15]=y*_+p*w+m*B+b*C,n}}]),e}()},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.GLTexture2D=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(2);t.GLTexture2D=function(){function e(t){var r=this,i=arguments.length<=1||void 0===arguments[1]?null:arguments[1],a=arguments.length<=2||void 0===arguments[2]?null:arguments[2];n(this,e),this.gl=t,i&&(0,o.createImageByURL)(i,function(e){r.texture=r.createTextureWithData(e),r.texWidth=e.width,r.texHeight=e.height,null!==a&&a()})}return i(e,[{key:"isPowerOf2",value:function(e){return 0===(e&e-1)}},{key:"createTextureWithData",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?!1:arguments[1];this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!0);var r=this.gl.createTexture();return this.gl.bindTexture(this.gl.TEXTURE_2D,r),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e),this.isPowerOf2(e.width)&&this.isPowerOf2(e.height)?(this.gl.generateMipmap(this.gl.TEXTURE_2D),t&&(this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.REPEAT),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.REPEAT))):(this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR)),this.gl.bindTexture(this.gl.TEXTURE_2D,null),r}},{key:"filterWithOperation",value:function(e){this.texture=e.excute(this)}},{key:"filterWithPipeline",value:function(e){var t=this;e.forEach(function(e){t.texture=e.excute(t)})}}]),e}()},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.LuminanceFilter=void 0;var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=r(8),s=r(5),l='\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\n// Values from "Graphics Shaders: Theory and Practice" by Bailey and Cunningham\nconst  vec3 W = vec3(0.2125, 0.7154, 0.0721);\nuniform sampler2D texture;\n\nvarying vec2 texCoord;\n\nvoid main(void) {\n    lowp vec4 textureColor = texture2D(texture, texCoord);\n    float luminance = dot(textureColor.rgb, W);\n    \n    gl_FragColor = vec4(vec3(luminance), textureColor.a);\n}\n';t.LuminanceFilter=function(e){function t(){return n(this,t),i(this,Object.getPrototypeOf(t).apply(this,arguments))}return o(t,e),a(t,[{key:"getProgramParams",value:function(){return[s.basicFilterVS,l,["vertexPosition","vTextureCoord"],["pMatrix","mvMatrix","texture"]]}}]),t}(u.IFilter)},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.GaussianBlurFilter=void 0;var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=r(8),s=r(5);t.GaussianBlurFilter=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?2:arguments[0],r=arguments.length<=1||void 0===arguments[1]?.84089642:arguments[1];n(this,t);var o=i(this,Object.getPrototypeOf(t).call(this));return o.radius=e,o.sigma=r,o}return o(t,e),a(t,[{key:"getProgramParams",value:function(){return[s.basicFilterVS,this.getBlurFS(),["vertexPosition","vTextureCoord"],["pMatrix","mvMatrix","texture","textureWidth","textureHeight"]]}},{key:"getBlurFS",value:function(){var e=this.getGaussianWeights(this.radius,this.sigma),t=0;e.forEach(function(e){t+=e});for(var r="",n=2*this.radius+1,i=1/this.texture.texWidth,o=1/this.texture.texHeight,a=0,u=0;n>u;u+=1)for(var s=0;n>s;s+=1)r+="sum =  sum + texture2D(texture,vec2(texCoord.x + float("+i+") * float("+(s-this.radius)+"), texCoord.y + float("+o+") * float("+(this.radius-u)+") ))* "+e[a]/t+" ; ",a++;return"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D texture;\nvarying vec2 texCoord;\n\nvoid main(void) {\n    vec4 sum = vec4(0.0, 0.0, 0.0, 0.0);\n    "+r+"\n    gl_FragColor = sum ;\n}\n"}},{key:"getGaussianWeights",value:function(e,t){for(var r=Math.pow(t,2),n=2*e+1,i=[],o=0;n>o;o++)for(var a=e-o,u=0;n>u;u++){var s=u-e,l=1/(2*Math.PI*r)*Math.exp(-((Math.pow(s,2)+Math.pow(a,2))/(2*r)));i.push(l)}return i}}]),t}(u.IFilter)},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.GoraudDefine="\nattribute vec3 vertexNormal;\n\nuniform mat4 normalMatrix; \nuniform vec3 lightDirection; \nuniform vec4 lightDiffuse; \nuniform vec4 materialDiffuse; \n\nvarying vec4 finalColor;\n ",t.GoraudCalculator="\nvec3 N = normalize(vec3(normalMatrix * vec4(vertexNormal, 1.0)));\nvec3 L = normalize(lightDirection);\nfloat lambertTerm = dot(N,-L);\nfinalColor = materialDiffuse * lightDiffuse * lambertTerm;\nfinalColor.a = 1.0;\n",t.phongModel="\n\n\n"},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();t.GLBezier=function(){function e(){r(this,e)}return n(e,[{key:"generateCoords",value:function(t){var r=arguments.length<=1||void 0===arguments[1]?0:arguments[1],n=arguments.length<=2||void 0===arguments[2]?.5:arguments[2],i=t[0],o=t[t.length-1];0===r&&(r=e.getDistance(i,o));var a=Math.floor(r*n);if(1>=a){var u=i[0]-o[0],s=i[1]-o[1];return[{coords:o,slope:Math.atan2(s,u),distance:Math.sqrt(u*u+s*s)}]}this.stepLength=1/a;for(var l=[],c=this.calculateControlEdge(t),f=t[0],h=0;a>h;h++){var v=this.calculateReferenceLine(t,c,h+1),d=v[1][0]-v[0][0],g=v[1][1]-v[0][1],y=v[0][0]+d*((h+1)*this.stepLength),p=v[0][1]+g*((h+1)*this.stepLength),m=y-f[0],b=p-f[1];f=[y,p],l.push({coords:[y,p],slope:Math.atan2(b,m),distance:Math.sqrt(m*m+b*b)})}return l}},{key:"calculateReferenceLine",value:function(e,t,r){for(var n=[],i=0;i<e.length-1;i++){var o=e[i][0]+t[i].deltaX*r,a=e[i][1]+t[i].deltaY*r;n.push([o,a])}if(2===n.length)return n;var u=this.calculateControlEdge(n);return this.calculateReferenceLine(n,u,r)}},{key:"calculateControlEdge",value:function(e){for(var t=[],r=1;r<e.length;r++){var n=e[r][0]-e[r-1][0],i=e[r][1]-e[r-1][1],o=this.edge();o.length=Math.sqrt(n*n+i*i),o.angleSin=i/o.length,o.angleCos=n/o.length,o.calculateDelta(this.stepLength),t.push(o)}return t}},{key:"edge",value:function(){return{length:0,angleCos:0,angleSin:0,deltaX:0,deltaY:0,calculateDelta:function(e){this.deltaX=e*this.length*this.angleCos,this.deltaY=e*this.length*this.angleSin}}}}],[{key:"getDistance",value:function(e,t){var r=t[0]-e[0],n=t[1]-e[1];return Math.sqrt(r*r+n*n)}}]),e}()},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();t.Matrix2d=function(){function e(){return r(this,e),e.identity()}return n(e,null,[{key:"identity",value:function(){return new Float32Array([1,0,0,1,0,0])}},{key:"copy",value:function(t){var r=e.identity();return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r}},{key:"scale",value:function(e,t){var r=t[0],n=t[1];e[0]*=r,e[1]*=r,e[2]*=n,e[3]*=n}},{key:"translate",value:function(e,t){var r=t[0],n=t[1];e[4]+=e[0]*r+e[2]*n,e[5]+=e[1]*r+e[3]*n}},{key:"rotate",value:function(e,t){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],u=e[5],s=Math.sin(t),l=Math.cos(t);return e[0]=r*l+i*s,e[1]=n*l+o*s,e[2]=r*-s+i*l,e[3]=n*-s+o*l,e[4]=a,e[5]=u,e}}]),e}()},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();t.Vector2=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?0:arguments[0],n=arguments.length<=1||void 0===arguments[1]?0:arguments[1];r(this,e),this.x=t,this.y=n}return n(e,[{key:"getArray",value:function(){return[this.x,this.y]}},{key:"transformByMat2d",value:function(e){var t=this.x,r=this.y;return this.x=e[0]*t+e[2]*r+e[4],this.y=e[1]*t+e[3]*r+e[5],this}},{key:"applyMatrix4",value:function(e){var t=this.x,r=this.y,n=0,i=1;this.x=e[0]*t+e[4]*r+e[8]*n+e[12]*i,this.y=e[1]*t+e[5]*r+e[9]*n+e[13]*i;var o=e[3]*t+e[7]*r+e[11]*n+e[15]*i;return this.x=this.x/o,this.y=this.y/o,this}},{key:"dotProduct",value:function(e){return this.x*e.x+this.y*e.y,this}},{key:"scale",value:function(e){return this.x*=e,this.y*=e,this}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this}},{key:"swapToModelPosition",value:function(){var e=arguments.length<=0||void 0===arguments[0]?1:arguments[0],t=arguments.length<=1||void 0===arguments[1]?0:arguments[1],r=arguments.length<=2||void 0===arguments[2]?0:arguments[2];return this.x=this.x*e-t,this.y=r-this.y*e,this}},{key:"isEqualTo",value:function(e){return e.x===this.x&&e.y===this.y}}],[{key:"generateVector",value:function(t,r){return new e(r[0]-t[0],r[1]-t[1]);
}},{key:"zeroVector",value:function(){return new e}},{key:"copy",value:function(t){return new e(t.x,t.y)}},{key:"sub",value:function(t,r){return new e(r.x-t.x,r.y-t.y)}}]),e}()},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();t.Vector3=function(){function e(){r(this,e)}return n(e,null,[{key:"applyMatrix4",value:function(e,t){var r=e[0],n=e[1],i=e[2],o=1;e[0]=t[0]*r+t[4]*n+t[8]*i+t[12]*o,e[1]=t[1]*r+t[5]*n+t[9]*i+t[13]*o,e[2]=t[2]*r+t[6]*n+t[10]*i+t[14]*o;var a=t[3]*r+t[7]*n+t[11]*i+t[15]*o;return e[0]=e[0]/a,e[1]=e[1]/a,e[2]=e[2]/a,e}}]),e}()},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();t.Vector4=function(){function e(){r(this,e)}return n(e,null,[{key:"applyMatrix4",value:function(e,t){var r=e[0],n=e[1],i=e[2],o=e[3];return e[0]=t[0]*r+t[4]*n+t[8]*i+t[12]*o,e[1]=t[1]*r+t[5]*n+t[9]*i+t[13]*o,e[2]=t[2]*r+t[6]*n+t[10]*i+t[14]*o,e[3]=t[3]*r+t[7]*n+t[11]*i+t[15]*o,e}}]),e}()},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.random="\n\n"},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();t.IAnimation=function(){function e(){r(this,e),this.animationHandler=null,this.isAnimating=!1}return n(e,[{key:"startAnimating",value:function(){var e=this;this.isAnimating=!0,this.frameIndex=0,this.animationHandler=requestAnimationFrame(function(){e.enterFrame()})}},{key:"stopAnimating",value:function(){cancelAnimationFrame(this.animationHandler),this.isAnimating=!1}},{key:"enterFrame",value:function(){var e=this;this.frameIndex++,this.animationHandler=requestAnimationFrame(function(){e.enterFrame()})}},{key:"destory",value:function(){this.stopAnimating()}}]),e}()},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();t.TouchManager=function(){function e(){r(this,e)}return n(e,null,[{key:"touchStartEventName",value:function(){return void 0===document.ontouchstart?"mousedown":"touchstart"}},{key:"touchMoveEventName",value:function(){return void 0===document.ontouchmove?"mousemove":"touchmove"}},{key:"touchEndEventName",value:function(){return void 0===document.ontouchend?"mouseup":"touchend"}},{key:"addTapListener",value:function(t,r){t.addEventListener(e.touchEndEventName(),r,!1)}},{key:"removeTapListener",value:function(t,r){t.removeEventListener(e.touchEndEventName(),r,!1)}},{key:"addTouchListener",value:function(t,r,n){var i=arguments.length<=3||void 0===arguments[3]?null:arguments[3];t.addEventListener(e.touchStartEventName(),function(i){r(i),t.addEventListener(e.touchMoveEventName(),n,!1)},!1),t.addEventListener(e.touchEndEventName(),function(r){i&&i(r),t.removeEventListener(e.touchMoveEventName(),n,!1)},!1)}},{key:"removeTouchListener",value:function(t,r,n){var i=arguments.length<=3||void 0===arguments[3]?null:arguments[3];t.removeEventListener(e.touchStartEventName(),r,!1),t.removeEventListener(e.touchMoveEventName(),n,!1),i&&t.removeEventListener(e.touchEndEventName(),i,!1)}}]),e}()},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.PlaneGeometry=void 0;var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=r(23);t.PlaneGeometry=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?1:arguments[0],r=arguments.length<=1||void 0===arguments[1]?1:arguments[1],o=arguments.length<=2||void 0===arguments[2]?1:arguments[2],a=arguments.length<=3||void 0===arguments[3]?1:arguments[3];n(this,t);var u=i(this,Object.getPrototypeOf(t).call(this)),s=e,l=r;return u.widthHalf=s/2,u.heightHalf=l/2,u.gridX=o,u.gridY=a,u.segmentWidth=s/u.gridX,u.segmentHeight=l/u.gridY,u.generateVetices(),u}return o(t,e),a(t,[{key:"generateVetices",value:function(){var e=this.gridX+1,t=this.gridY+1;this.vertices=new Float32Array(e*t*3),this.textureCoords=new Float32Array(e*t*2),this.normals=new Float32Array(e*t*3);for(var r=0,n=0,i=0;t>i;i++)for(var o=i*this.segmentHeight-this.heightHalf,a=0;e>a;a++){var u=a*this.segmentWidth-this.widthHalf;this.vertices[r]=u,this.vertices[r+1]=-o,this.vertices[r+2]=0,this.textureCoords[n]=a/this.gridX,this.textureCoords[n+1]=1-i/this.gridY,r+=3,n+=2}r=0,this.indices=new(this.vertices.length/3>65535?Uint32Array:Uint16Array)(this.gridX*this.gridY*6);for(var s=0;s<this.gridY;s++)for(var l=0;l<this.gridX;l++){var c=l+e*s,f=l+e*(s+1),h=l+1+e*(s+1),v=l+1+e*s;this.indices[r]=c,this.indices[r+1]=f,this.indices[r+2]=v,this.indices[r+3]=f,this.indices[r+4]=h,this.indices[r+5]=v,r+=6}}}]),t}(u.Geometry)},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.Geometry=void 0;var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=r(24);t.Geometry=function(e){function t(){n(this,t);var e=i(this,Object.getPrototypeOf(t).call(this));return e.vertices=[],e.colors=[],e.indices=[],e.textureCoords=[],e.vetexBuffer=null,e.indexBuffer=null,e.textureBuffer=null,e.faces=[],e.faceVertexUvs=[[]],e.skinWeights=[],e.skinIndices=[],e.lineDistances=[],e.boundingBox=null,e.boundingSphere=null,e.hasTangents=!1,e.dynamic=!0,e.verticesNeedUpdate=!1,e.elementsNeedUpdate=!1,e.uvsNeedUpdate=!1,e.normalsNeedUpdate=!1,e.tangentsNeedUpdate=!1,e.colorsNeedUpdate=!1,e.lineDistancesNeedUpdate=!1,e.groupsNeedUpdate=!1,e}return o(t,e),a(t,[{key:"createBuffers",value:function(e){this.vetexBuffer=e.createArrayBufferWithData(this.vertices),this.indexBuffer=e.createElementBufferWithData(this.indices),this.textureBuffer=e.createArrayBufferWithData(this.textureCoords)}},{key:"bindBuffers",value:function(e,t,r){e.enableVertexAttribArray(t[r[0]]),e.bindBuffer(e.ARRAY_BUFFER,this.vetexBuffer),e.vertexAttribPointer(t[r[0]],3,e.FLOAT,!1,0,0),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.enableVertexAttribArray(t[r[1]]),e.bindBuffer(e.ARRAY_BUFFER,this.textureBuffer),e.vertexAttribPointer(t[r[1]],2,e.FLOAT,!1,0,0)}},{key:"calculateNormals",value:function(e,t){for(var r=0,n=1,i=2,o=[],a=0;a<e.length;a++)o[a]=0;for(var a=0;a<t.length;a+=3){var u=[],s=[],l=[];u[r]=e[3*t[a+1]+r]-e[3*t[a]+r],u[n]=e[3*t[a+1]+n]-e[3*t[a]+n],u[i]=e[3*t[a+1]+i]-e[3*t[a]+i],s[r]=e[3*t[a+2]+r]-e[3*t[a+1]+r],s[n]=e[3*t[a+2]+n]-e[3*t[a+1]+n],s[i]=e[3*t[a+2]+i]-e[3*t[a+1]+i],l[r]=u[n]*s[i]-u[i]*s[n],l[n]=u[i]*s[r]-u[r]*s[i],l[i]=u[r]*s[n]-u[n]*s[r];for(var c=0;3>c;c++)o[3*t[a+c]+r]=o[3*t[a+c]+r]+l[r],o[3*t[a+c]+n]=o[3*t[a+c]+n]+l[n],o[3*t[a+c]+i]=o[3*t[a+c]+i]+l[i]}for(var a=0;a<e.length;a+=3){var f=[];f[r]=o[a+r],f[n]=o[a+n],f[i]=o[a+i];var h=Math.sqrt(f[r]*f[r]+f[n]*f[n]+f[i]*f[i]);0==h&&(h=1e-5),f[r]=f[r]/h,f[n]=f[n]/h,f[i]=f[i]/h,o[a+r]=f[r],o[a+n]=f[n],o[a+i]=f[i]}return o}}]),t}(u.Object3D)},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.Object3D=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(9);r(17),t.Object3D=function(){function e(){n(this,e),this.renderer=null,this.matrix=o.Matrix4.identity(),this.needsUpdatePosition=!1,this.needsUpdateScale=!1,this.needsUpdateRotation=!1}return i(e,[{key:"setSceneParams",value:function(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0],t=arguments.length<=1||void 0===arguments[1]?0:arguments[1],r=arguments.length<=2||void 0===arguments[2]?0:arguments[2];this.matrix=o.Matrix4.identity(),this.distanceX=e*this.devicePixelRatio-this.renderer.centerX,this.distanceY=this.renderer.centerY-t*this.devicePixelRatio,o.Matrix4.translate(this.matrix,[this.distanceX,this.distanceY,0]),this.ruler.x+=r,this.ruler.y+=r,o.Matrix4.ruler(this.matrix,[this.ruler.x,this.ruler.y,1])}},{key:"configAnimationTarget",value:function(e){this.speed=.1;var t=e.position;t&&(this.needsUpdatePosition=!0,this.targetPosition=t.swapToModelPosition(this.devicePixelRatio,this.sceneWidthHalf,this.sceneHeightHalf));var r=e.ruler;r&&(this.needsUpdateScale=!0,this.targetScale=r);var n=e.rotation;n&&(this.needsUpdateRotation=!0,this.targetRotation=n)}},{key:"stepAnimating",value:function(){this.matrix=o.Matrix4.identity(),this.needsUpdatePosition&&(this.position.x+=(this.targetPosition.x-this.position.x)*this.speed,this.position.y+=(this.targetPosition.y-this.position.y)*this.speed,o.Matrix4.translate(this.matrix,[this.position.x,this.position.y,0])),this.needsUpdateScale&&(this.ruler.x+=(this.targetScale.x-this.ruler.x)*this.speed,this.ruler.y+=(this.targetScale.y-this.ruler.y)*this.speed,o.Matrix4.ruler(this.matrix,[this.ruler.x,this.ruler.y,1]))}},{key:"devicePixelRatio",get:function(){return void 0===this._devicePixelRatio&&(this._devicePixelRatio=window.devicePixelRatio),this._devicePixelRatio},set:function(e){this._devicePixelRatio=e}},{key:"position",get:function(){return this._position},set:function(e){this._position=e}},{key:"scale",get:function(){return this._scale},set:function(e){this._scale=e}}]),e}()},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();t.GLTexture1D=function(){function e(t,n){r(this,e),this.gl=t,this.texture=this.createTexture1D(n)}return n(e,[{key:"createTexture1D",value:function(e){var t=this.gl.createTexture(),r=this.gl.getExtension("OES_texture_float");if(!r)throw new Error("不支持浮点数纹理");return this.gl.bindTexture(this.gl.TEXTURE_2D,t),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,e.length/4,1,0,this.gl.RGBA,this.gl.FLOAT,e),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.gl.bindTexture(this.gl.TEXTURE_2D,null),t}}]),e}()}])});