!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("GREN")):"function"==typeof define&&define.amd?define("FRACTAL",["GREN"],e):"object"==typeof exports?exports.FRACTAL=e(require("GREN")):t.FRACTAL=e(t.GREN)}(this,function(t){return function(t){function e(i){if(r[i])return r[i].exports;var n=r[i]={exports:{},id:i,loaded:!1};return t[i].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var r={};return e.m=t,e.c=r,e.p="",e(0)}([function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(1);Object.keys(i).forEach(function(t){"default"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return i[t]}})});var n=r(3);Object.keys(n).forEach(function(t){"default"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return n[t]}})})},function(t,e,r){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),a=function l(t,e,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,e);if(void 0===i){var n=Object.getPrototypeOf(t);return null===n?void 0:l(n,e,r)}if("value"in i)return i.value;var o=i.get;if(void 0!==o)return o.call(r)},h=r(2),c=(e.KochCurve=function(t){function e(){var t=arguments.length<=0||void 0===arguments[0]?300:arguments[0],r=arguments.length<=1||void 0===arguments[1]?100:arguments[1];i(this,e);var o=n(this,Object.getPrototypeOf(e).call(this));return o.renderer=new h.WebGLRenderer,o.renderer.setStyle(t,r,"margin:0px; position:absolute; z-index:1;"),o.gl=o.renderer.gl,o.domElement=o.renderer.canvas,o.renderer.isWebGLSuported===!1?n(o):(o.pMatrix=h.Matrix4.orthogonal(0,o.renderer.canvasWidth,0,o.renderer.canvasHeight,-5e3,5e3),o._initProgram(),o._initKochLines(),o.startAnimating(),o)}return o(e,t),s(e,[{key:"_initProgram",value:function(){this.prg=this.gl.makeProgram(h.commonVS,h.commonFS),this.prg&&(this.prg.setAttribLocations(["vertexPosition"]),this.prg.setUniformLocations(["pMatrix","mvMatrix","color"]),this.gl.uniformMatrix4fv(this.prg.pMatrix,!1,this.pMatrix),this.gl.uniform4fv(this.prg.color,[1,1,1,1]))}},{key:"_initKochLines",value:function(){this.maxIterations=5,this.curIterations=0,this.maxInterpolation=35,this.curInterpolation=0;var t=30*window.devicePixelRatio,e=this.renderer.canvasWidth-2*t,r=Math.sin(60/180*Math.PI)*e,i=Math.sin(60/180*Math.PI)*(e/3),n=new h.Vector2(this.renderer.centerX,this.renderer.centerY+(r+i)/2),o=n.y-r;this.lines=[];var s=this.renderer.centerX-t,a=new h.Vector2(-s,0),l=new h.Vector2(s,0),u=new c(a,l);this.lines.push(u),this.mvMatList=[];var p=new h.Matrix4;h.Matrix4.translate(p,[this.renderer.centerX,o,0]),h.Matrix4.rotate(p,p,Math.PI,[0,0,1]),this.mvMatList.push(p);var f=new h.Vector2(t,o),d=new h.Vector2(this.renderer.canvasWidth-t,o),g=h.Vector2.sub(f,n).scale(.5).add(f),v=h.Vector2.sub(d,n).scale(.5).add(d),x=new h.Matrix4;h.Matrix4.translate(x,[g.x,g.y,0]),h.Matrix4.rotate(x,x,60/180*Math.PI,[0,0,1]),this.mvMatList.push(x);var y=new h.Matrix4;h.Matrix4.translate(y,[v.x,v.y,0]),h.Matrix4.rotate(y,y,-60/180*Math.PI,[0,0,1]),this.mvMatList.push(y)}},{key:"updateFrameData",value:function(){var t=this.lines[0],e=t.start;this.vertices=[e.x,e.y,0],this.indices=[0];var r=1;this.curInterpolation===this.maxInterpolation&&(this.curInterpolation=0,this.maxInterpolation=Math.ceil(.7*this.maxInterpolation),this.curIterations+=1),this.curInterpolation+=1;var i=!1,n=[];this.curInterpolation===this.maxInterpolation&&(i=!0);for(var o=0;o<this.lines.length;o++){var s=this.lines[o],a=s.generatePointB(this.curInterpolation/this.maxInterpolation);this.vertices=this.vertices.concat([s.pointA.x,s.pointA.y,0,a.x,a.y,0,s.pointC.x,s.pointC.y,0,s.end.x,s.end.y,0]),this.indices=this.indices.concat([r,r+1,r+2,r+3]),i&&(n.push(new c(s.start,s.pointA)),n.push(new c(s.pointA,a)),n.push(new c(a,s.pointC)),n.push(new c(s.pointC,s.end))),r+=4}i&&(this.lines=n);var h=this.gl.createArrayBufferWithTypedArray(new Float32Array(this.vertices));this.gl.enableVertexAttribArray(this.prg.vertexPosition),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,h),this.gl.vertexAttribPointer(this.prg.vertexPosition,3,this.gl.FLOAT,!1,0,0),this.indexBuffer=this.gl.createElementBufferWithTypedArray(new Uint16Array(this.indices)),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer),this.curIterations===this.maxIterations&&this.curInterpolation===this.maxInterpolation&&this._initKochLines()}},{key:"enterFrame",value:function(){var t=this;a(Object.getPrototypeOf(e.prototype),"enterFrame",this).call(this),this.updateFrameData(),this.gl.clearColor(0,0,0,0),this.gl.viewport(0,0,this.renderer.canvasWidth,this.renderer.canvasHeight),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.gl.lineWidth(2),this.mvMatList.forEach(function(e){t.gl.uniformMatrix4fv(t.prg.mvMatrix,!1,e),t.gl.drawElements(t.gl.LINE_STRIP,t.indices.length,t.gl.UNSIGNED_SHORT,0)})}}]),e}(h.IAnimation),function(){function t(e,r){i(this,t),this.start=e,this.end=r,this.vector=new h.Vector2(this.end.x-this.start.x,this.end.y-this.start.y),this.center=h.Vector2.copy(this.vector).scale(.5).add(this.start);var n=h.Vector2.copy(this.vector).scale(1/3),o=h.Vector2.copy(this.vector).scale(2/3),s=new h.Matrix4;h.Matrix4.rotate(s,s,60/180*Math.PI,[0,0,1]);var a=h.Vector2.sub(n,o).applyMatrix4(s);this.pointA=n.add(this.start);var c=a.add(this.pointA);this.pointC=o.add(this.start),this.animationVector=h.Vector2.sub(this.center,c)}return s(t,[{key:"generatePointB",value:function(t){return h.Vector2.copy(this.animationVector).scale(t).add(this.center)}}]),t}())},function(e,r){e.exports=t},function(t,e,r){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),a=function l(t,e,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,e);if(void 0===i){var n=Object.getPrototypeOf(t);return null===n?void 0:l(n,e,r)}if("value"in i)return i.value;var o=i.get;if(void 0!==o)return o.call(r)},h=r(2),c=(e.Tree=function(t){function e(){var t=arguments.length<=0||void 0===arguments[0]?300:arguments[0],r=arguments.length<=1||void 0===arguments[1]?100:arguments[1];i(this,e);var o=n(this,Object.getPrototypeOf(e).call(this));return o.renderer=new h.WebGLRenderer,o.renderer.setStyle(t,r,"margin:0px; position:absolute; z-index:1;"),o.gl=o.renderer.gl,o.domElement=o.renderer.canvas,o.renderer.isWebGLSuported===!1?n(o):(o.pMatrix=h.Matrix4.orthogonal(0,o.renderer.canvasWidth,0,o.renderer.canvasHeight,-5e3,5e3),o._initProgram(),o._initTreeLines(),o.startAnimating(),o)}return o(e,t),s(e,[{key:"_initProgram",value:function(){this.prg=this.gl.makeProgram(h.commonVS,h.commonFS),this.prg&&(this.prg.setAttribLocations(["vertexPosition"]),this.prg.setUniformLocations(["pMatrix","mvMatrix","color"]),this.gl.uniformMatrix4fv(this.prg.pMatrix,!1,this.pMatrix),this.gl.uniformMatrix4fv(this.prg.mvMatrix,!1,new h.Matrix4),this.gl.uniform4fv(this.prg.color,[1,1,1,1]))}},{key:"_initTreeLines",value:function(){this.maxIterations=7,this.curIterations=0,this.maxInterpolation=35,this.curInterpolation=0,this.maxPauseFrame=60,this.curPauseFrameIndex=0,this.OffsetAngle=25;var t=.33*this.renderer.canvasHeight,e=new h.Vector2(this.renderer.centerX,this.renderer.centerY-t),r=new h.Vector2(this.renderer.centerX,this.renderer.centerY);this.lines=[new c(e,r,0,1)],this.fixedVertices=[e.x,e.y,0],this.growingVertices=[],this.iBufferList=[],this.indicesLength=[],this.nextLineEndIndexOffset=1}},{key:"updateFrameData",value:function(){if(this.curIterations===this.maxIterations&&this.curInterpolation===this.maxInterpolation)return void(this.curPauseFrameIndex<this.maxPauseFrame?this.curPauseFrameIndex++:this._initTreeLines());if(this.curInterpolation===this.maxInterpolation){this.curInterpolation=0,this.maxInterpolation=Math.ceil(.8*this.maxInterpolation),this.curIterations+=1,this.nextLineEndIndexOffset*=2;var t=this.nextLineEndIndexOffset,e=[],r=.3*(this.curIterations-1);r>.4&&(r=.4);for(var i=0;i<this.lines.length;i++){var n=this.lines[i];e.push(new c(n.end,n.nextPointLeft,n.endIndex,t,r)),e.push(new c(n.end,n.nextPointRight,n.endIndex,t+1,r)),t+=2}this.lines=e,this.fixedVertices=this.fixedVertices.concat(this.growingVertices)}else this.iBufferList.pop();this.curInterpolation+=1,this.growingVertices=[];for(var o=[],s=0;s<this.lines.length;s++){var a=this.lines[s],h=a.generateGrowPoint(this.curInterpolation/this.maxInterpolation);this.growingVertices=this.growingVertices.concat([h.x,h.y,0]),o=o.concat([a.startIndex,a.endIndex])}var l=this.gl.createArrayBufferWithData(this.fixedVertices.concat(this.growingVertices));this.gl.bindBuffer(this.gl.ARRAY_BUFFER,l),this.gl.vertexAttribPointer(this.prg.vertexPosition,3,this.gl.FLOAT,!1,0,0);var u=this.gl.createElementBufferWithTypedArray(new Uint16Array(o));this.iBufferList.push(u),this.indicesLength[this.curIterations]=o.length}},{key:"enterFrame",value:function(){a(Object.getPrototypeOf(e.prototype),"enterFrame",this).call(this),this.updateFrameData(),this.gl.clearColor(0,0,0,0),this.gl.viewport(0,0,this.renderer.canvasWidth,this.renderer.canvasHeight),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.gl.enableVertexAttribArray(this.prg.vertexPosition);for(var t=5*window.devicePixelRatio,r=0;r<this.iBufferList.length;r++)this.gl.lineWidth(t),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.iBufferList[r]),this.gl.drawElements(this.gl.LINES,this.indicesLength[r],this.gl.UNSIGNED_SHORT,0),t-=1*window.devicePixelRatio,2>t&&(t=2)}}]),e}(h.IAnimation),function(){function t(e,r,n,o){var s=arguments.length<=4||void 0===arguments[4]?0:arguments[4];i(this,t),this.start=e,this.end=r,this.startIndex=n,this.endIndex=o,this.vector=new h.Vector2(this.end.x-this.start.x,this.end.y-this.start.y);var a=h.Vector2.copy(this.vector).scale(.35+s),c=this._getRotateMatrix(30);this.nextPointLeft=h.Vector2.copy(a).applyMatrix4(c).add(this.end);var l=this._getRotateMatrix(-30);this.nextPointRight=h.Vector2.copy(a).applyMatrix4(l).add(this.end)}return s(t,[{key:"_getRotateMatrix",value:function(t){var e=new h.Matrix4;return t+=t/3*(Math.random()-.5),h.Matrix4.rotate(e,e,t/180*Math.PI,[0,0,1]),e}},{key:"generateGrowPoint",value:function(t){return h.Vector2.copy(this.vector).scale(t).add(this.start)}}]),t}())}])});