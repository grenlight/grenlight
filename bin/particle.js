!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("GREN"),require("GMath")):"function"==typeof define&&define.amd?define("PARTICLE",["GREN","GMath"],e):"object"==typeof exports?exports.PARTICLE=e(require("GREN"),require("GMath")):t.PARTICLE=e(t.GREN,t.GMath)}(this,function(t,e){return function(t){function e(r){if(i[r])return i[r].exports;var n=i[r]={exports:{},id:r,loaded:!1};return t[r].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(1);Object.keys(r).forEach(function(t){"default"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return r[t]}})})},function(t,e,i){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0}),e.SimpleSmoke=void 0;var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}(),l=function p(t,e,i){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,e);if(void 0===r){var n=Object.getPrototypeOf(t);return null===n?void 0:p(n,e,i)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(i)},s=i(2),h="\nattribute vec4 particle;\n\nuniform mat4 mvMatrix;\nuniform mat4 pMatrix;\nuniform float particleSize;\n\nvarying float  lifeSpan;\n\nvoid main(void) {\n  gl_Position = pMatrix * mvMatrix * vec4(particle.xyz, 1.0);\n  lifeSpan = particle.w;\n  // float halfSize = particleSize/2.0;\n  gl_PointSize = particleSize * lifeSpan;\n  // gl_PointSize = particleSize;\n}\n",u="\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform vec4 color;\nuniform sampler2D texture;\n\nvarying float lifeSpan;\n\nvoid main(void) {\n  // gl_FragColor = vec4(color.rgb, color.a * lifeSpan);\n     vec4 pixel = texture2D(texture, gl_PointCoord);\n     gl_FragColor = vec4(pixel.rgb, pixel.a *lifeSpan);\n}\n",f=i(3),c=i(4),g=(e.SimpleSmoke=function(t){function e(){var t=arguments.length<=0||void 0===arguments[0]?300:arguments[0],i=arguments.length<=1||void 0===arguments[1]?100:arguments[1];r(this,e);var a=n(this,Object.getPrototypeOf(e).call(this));return a.renderer=new f.WebGLRenderer,a.renderer.setStyle(t,i,"margin:0px; position:absolute; z-index:1;"),a.gl=a.renderer.gl,a.domElement=a.renderer.canvas,a.renderer.isWebGLSuported===!1?n(a):(a.pMatrix=f.Matrix4.orthogonal(-a.renderer.centerX,a.renderer.centerX,-a.renderer.centerY,a.renderer.centerY,-5e3,5e3),a.gradientTex=new s.GradientCircularTexture(a.renderer,30*window.devicePixelRatio,[1,1,1,.9]),a.gradientTex.filterWithOperation(new f.GaussianBlurFilter(3,3)),a._initProgram(),a.initParticles(),a.gl.activeTexture(a.gl.TEXTURE0),a.gl.bindTexture(a.gl.TEXTURE_2D,a.gradientTex.texture),a.gl.uniform1i(a.prg.texture,0),a.startAnimating(),a)}return a(e,t),o(e,[{key:"_initProgram",value:function(){this.prg=this.gl.makeProgram(h,u),this.prg.setAttribLocations(["particle"]),this.prg.setUniformLocations(["pMatrix","mvMatrix","particleSize","color","texture"]),this.gl.uniformMatrix4fv(this.prg.pMatrix,!1,this.pMatrix),this.gl.uniformMatrix4fv(this.prg.mvMatrix,!1,new f.Matrix4),this.gl.uniform1f(this.prg.particleSize,50*window.devicePixelRatio),this.gl.uniform4fv(this.prg.color,[1,1,1,1])}},{key:"initParticles",value:function(){this.lastFrameTime=Date.now(),this.particleCount=1e3,this.perFrameActivate=this.particleCount/180,this.particles=[],this.particleVertices=new Float32Array(4*this.particleCount),this.vertexBuffer=this.gl.createArrayBufferWithTypedArray(this.particleVertices);for(var t=new c.NormalDistribution,e=0;e<this.particleCount;e++){var i=new g(t);this.particles.push(i)}}},{key:"updateParticles",value:function(t){for(var e=0,i=0;i<this.particleCount;i++){var r=this.particles[i];r.isActivated?(r.update(t),this.particleVertices[4*i]=r.pos[0],this.particleVertices[4*i+1]=r.pos[1],this.particleVertices[4*i+2]=r.pos[2],this.particleVertices[4*i+3]=r.remainingLife/r.lifeSpan):e<this.perFrameActivate&&(r.reset(4,[0,-100*window.devicePixelRatio,0]),e++)}this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.particleVertices,this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.prg.particle,4,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.prg.particle)}},{key:"enterFrame",value:function(){l(Object.getPrototypeOf(e.prototype),"enterFrame",this).call(this);var t=Date.now();this.updateParticles((t-this.lastFrameTime)/1e3),this.lastFrameTime=t,this.gl.clearColor(0,0,0,0),this.gl.viewport(0,0,this.renderer.canvasWidth,this.renderer.canvasHeight),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.gl.enable(this.gl.BLEND),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.drawArrays(this.gl.POINTS,0,this.particleCount)}}]),e}(f.IAnimation),function(){function t(e){r(this,t),this.isActivated=!1,this.nd=e}return o(t,[{key:"reset",value:function(t,e){this.isActivated=!0,this.pos=e,this.vel=[5*this.nd.nextGaussian(),5*this.nd.nextGaussian()+60,40*Math.random()-20],this.lifeSpan=t+(Math.random()-.5)*t,this.remainingLife=this.lifeSpan}},{key:"update",value:function(t){this.remainingLife-=t,this.remainingLife<=0&&(this.remainingLife=0,this.isActivated=!1),this.pos[0]+=this.vel[0]*t,this.pos[1]+=this.vel[1]*t,this.pos[2]+=this.vel[2]*t}}]),t}())},function(t,e,i){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}(),l="\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform vec4 color;\nuniform float radius;\n\nvoid main(void) {\n    // float distance = sqrt(gl_FragCoord.x*gl_FragCoord.x + gl_FragCoord.y * gl_FragCoord.y);\n   \n    float distance = sqrt(pow(gl_FragCoord.x - radius, 2.0) + pow(radius - gl_FragCoord.y, 2.0));\n\n    float alpha = ((radius - distance) / radius) * color.a;\n    if (alpha < 0.0) {\n        alpha = 0.0;\n     }\n    gl_FragColor = vec4(color.rgb, alpha);\n}\n",s=i(3);e.GradientCircularTexture=function(t){function e(t,i,a){r(this,e);var o=n(this,Object.getPrototypeOf(e).call(this,t.gl));o.texWidth=i,o.texHeight=i,o.gl=t.gl,o.gl.viewport(0,0,2*i,2*i);var l=s.Matrix4.orthogonal(0,2*i,0,2*i,-1e3,1e3);return o._initProgram(l,i,a),o.configBuffer(i),o.draw(),o}return a(e,t),o(e,[{key:"_initProgram",value:function(t,e,i){this.prg=this.gl.makeProgram(s.commonVS,l),this.prg&&(this.prg.setAttribLocations(["vertexPosition"]),this.prg.setUniformLocations(["pMatrix","mvMatrix","radius","color"]),this.gl.uniformMatrix4fv(this.prg.pMatrix,!1,t),this.gl.uniformMatrix4fv(this.prg.mvMatrix,!1,new s.Matrix4),this.gl.uniform1f(this.prg.radius,e),this.gl.uniform4fv(this.prg.color,i))}},{key:"configBuffer",value:function(t){var e=[0,2*t,0,0,0,0,2*t,2*t,0,2*t,0,0],i=this.gl.createArrayBufferWithData(e);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,i),this.gl.vertexAttribPointer(this.prg.vertexPosition,3,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.prg.vertexPosition);var r=[0,1,2,1,2,3],n=this.gl.createElementBufferWithData(r);this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,n),this.texture=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,2*t,2*t,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST);var a=this.gl.createRenderbuffer();this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,a),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_COMPONENT16,2*t,2*t);var o=this.gl.createFramebuffer();this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,o),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this.texture,0),this.gl.framebufferRenderbuffer(this.gl.FRAMEBUFFER,this.gl.DEPTH_ATTACHMENT,this.gl.RENDERBUFFER,a)}},{key:"draw",value:function(){this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.gl.enable(this.gl.BLEND),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.drawElements(this.gl.TRIANGLES,6,this.gl.UNSIGNED_SHORT,0),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null)}}]),e}(s.GLTexture2D)},function(e,i){e.exports=t},function(t,i){t.exports=e}])});